<!DOCTYPE html>
<html>
<head>
    <title>The Forge - Creative Tools</title>
    <!-- Google Fonts Link -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="icon" type="image/png" href="favicon.png">

    <style>
        /* All of your existing CSS is unchanged */
        body { font-family: 'Roboto', sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 20px 10px; display: flex; flex-direction: column; align-items: center; }
        .title-container { display: flex; align-items: center; justify-content: center; width: 95%; gap: clamp(10px, 2.5vw, 20px); margin-bottom: 15px; }
        .logo-img { height: clamp(40px, 6vw, 60px); width: auto; flex-shrink: 0; }
        h1 { color: #64b5f6; text-align: center; margin: 0; font-size: clamp(1.5em, 5vw, 2.5em); line-height: 1.2; }
        nav { width: 100%; max-width: 1200px; text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        nav a { color: #b0b0b0; text-decoration: none; font-weight: bold; padding: 10px 15px; margin: 0 5px; border-radius: 6px; transition: background-color 0.2s, color 0.2s; }
        nav a:hover { background-color: #2a2a2a; color: #fff; }
        nav a.active { color: #fff; background-color: #007bff; }
        .disclaimer { text-align: center; font-style: italic; color: #aaa; max-width: 700px; margin-bottom: 30px; line-height: 1.6; }
        .page-container { width: 95%; max-width: 1200px; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; align-items: start; }
        .column-title { font-size: 1.8em; color: #64b5f6; margin-top: 0; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #333; }
        .collapsible { background-color: #1e1e1e; color: #e0e0e0; cursor: pointer; padding: 18px; width: 100%; border: 1px solid #333; border-radius: 8px; text-align: left; outline: none; font-size: 1.2em; font-weight: bold; transition: background-color 0.2s; position: relative; margin-top: 15px; }
        .collapsible:hover, .collapsible.active { background-color: #2a2a2a; }
        .collapsible::after { content: '+'; font-size: 1.5em; color: #aaa; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); transition: transform 0.3s ease; }
        .collapsible.active::after { content: "âˆ’"; transform: translateY(-50%) rotate(180deg); }
        .content { padding: 0 18px; max-height: 0; overflow: hidden; background-color: transparent; transition: max-height 0.3s ease-out; }
        .content ul, .manuals-list { list-style-type: none; padding: 15px 0 0 0; margin: 0; }
        .tool-card { background-color: #252525; margin-bottom: 15px; border-radius: 8px; border: 1px solid #444; transition: transform 0.2s, background-color 0.2s; }
        .tool-card:hover { transform: translateY(-4px); background-color: #333; }
        .tool-link { display: block; text-decoration: none; padding: 20px; }
        .tool-link h2 { margin: 0 0 8px 0; font-size: 1.4em; color: #8ab4f8; }
        .tool-link p { margin: 0 0 15px 0; font-size: 0.95em; color: #b0b0b0; line-height: 1.5; }
        .tags-container { display: flex; gap: 8px; flex-wrap: wrap; }
        .tag { color: #fff; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .tag.websource { background-color: #006064; }
        .tag.program   { background-color: #e65100; }
        .tag.manual    { background-color: #4a148c; }
        @media (max-width: 800px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="title-container">
        <img src="logo-white.png" alt="Logo" class="logo-img">
        <h1>The Forge - Creative Tools</h1>
        <img src="logo-white.png" alt="Logo" class="logo-img">
    </div>

    <nav>
        <a href="index.html" class="active">Tools & Manuals</a>
        <a href="workflows.html">Workflows</a>
    </nav>

    <p class="disclaimer">These are tools I work with. If you are here, you can take advantage of that and also use them. Most of them are full free or free with resetting time limit. Enjoy.</p>
    
    <div class="page-container">
        <div class="main-grid">
            <div class="column" id="tools-column">
                <h2 class="column-title">Tools</h2>
            </div>
            <div class="column" id="manuals-column">
                <h2 class="column-title">Manuals to my gear</h2>
                <ul class="manuals-list" id="manuals-list"></ul>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const googleSheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSTk4WkCpCLDXiyt_2xyPU3s1y_6W-LeKiUcOQsRHBs5hnqDBb3N2zbCuZxxlSc3YZY2pxoGbjm57pi/pub?output=csv';

        // --- DATA FETCHING AND PAGE BUILDING LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            fetch(googleSheetURL)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.text();
                })
                .then(text => {
                    const data = parseCSV(text);
                    buildPage(data);
                    initializeCollapsibles();
                })
                .catch(error => {
                    console.error("Error fetching or parsing data:", error);
                    const toolsColumn = document.getElementById('tools-column');
                    toolsColumn.innerHTML += "<p style='color: #ff5555;'>Could not load tools. The data source might be unavailable or incorrectly formatted.</p>";
                });
        });

        // --- NEW: ROBUST CSV PARSER ---
        function parseCSV(text) {
            const lines = text.split(/\r\n|\n/);
            const headers = lines[0].split(',');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                const obj = {};
                // This regex handles commas inside quoted fields
                const values = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                if (values.length !== headers.length) continue; // Skip malformed rows
                
                for (let j = 0; j < headers.length; j++) {
                    let value = values[j] || '';
                    // Remove quotes from start and end
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    // Replace double quotes with a single quote
                    value = value.replace(/""/g, '"');
                    
                    const header = headers[j].trim();
                    if (header === 'Tags') {
                        obj[header.toLowerCase()] = value ? value.trim().split(' ').join('').split(',') : [];
                    } else {
                        obj[header.toLowerCase()] = value.trim();
                    }
                }
                result.push(obj);
            }
            return result;
        }

        function buildPage(data) {
            const toolsColumn = document.getElementById('tools-column');
            const manualsList = document.getElementById('manuals-list');
            const toolsCategories = {};

            // First, separate items into Tools and Manuals
            const tools = data.filter(item => item.column === 'Tools');
            const manuals = data.filter(item => item.column === 'Manuals');

            // Process Tools
            tools.forEach(tool => {
                if (!toolsCategories[tool.category]) {
                    toolsCategories[tool.category] = [];
                }
                const tagsHTML = tool.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('');
                const cardHTML = `
                    <li class="tool-card">
                        <a href="${tool.url}" target="_blank" rel="noopener noreferrer" class="tool-link">
                            <h2>${tool.name}</h2>
                            <p>${tool.description}</p>
                            <div class="tags-container">${tagsHTML}</div>
                        </a>
                    </li>`;
                toolsCategories[tool.category].push(cardHTML);
            });

            let toolsHtmlContent = '';
            for (const category in toolsCategories) {
                toolsHtmlContent += `
                    <button type="button" class="collapsible">${category}</button>
                    <div class="content">
                        <ul>${toolsCategories[category].join('')}</ul>
                    </div>`;
            }
            toolsColumn.innerHTML += toolsHtmlContent;

            // Process Manuals
            let manualsHtmlContent = '';
            manuals.forEach(manual => {
                const tagsHTML = manual.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('');
                manualsHtmlContent += `
                    <li class="tool-card">
                        <a href="${manual.url}" target="_blank" rel="noopener noreferrer" class="tool-link">
                            <h2>${manual.name}</h2>
                            <p>${manual.description}</p>
                            <div class="tags-container">${tagsHTML}</div>
                        </a>
                    </li>`;
            });
            manualsList.innerHTML = manualsHtmlContent;
        }

        function initializeCollapsibles() {
            const collapsibles = document.querySelectorAll(".collapsible");
            collapsibles.forEach(button => {
                button.addEventListener("click", function() {
                    this.classList.toggle("active");
                    const content = this.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            });
        }
    </script>

</body>
</html>
